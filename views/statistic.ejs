<!DOCTYPE html>
<html lang="en">

<head>
  <%- include header.ejs %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
    <script type = "text/javascript" src="../../js/stat.js"></script>
</head>

<body>

  <nav class="navbar navbar-inverse sidebar" role="navigation">
    <div class="container-fluid">
      <%- include small_device_nav.ejs %>
        <div id="tab" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="/">HOME<span style="font-size:16px;" class="pull-right hidden-xs glyphicon glyphicon-home"></span></a></li>
            <li class="dropdown">
              <a href="/menu" class="dropdown-toggle" data-toggle="dropdown">MENU<span class="caret"></span><span style="font-size:16px;" class="pull-right hidden-xs glyphicon glyphicon-cutlery"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="/menu">TODAY</a></li>
                <li><a href="/menu/mon">MONDAY</a></li>
                <li><a href="/menu/tue">TUESDAY</a></li>
                <li><a href="/menu/wed">WEDNESDAY</a></li>
                <li><a href="/menu/thu">THURSDAY</a></li>
                <li><a href="/menu/fri">FRIDAY</a></li>
              </ul>
            </li>
            <li><a href="/order">ORDER<span style="font-size:16px;" class="pull-right hidden-xs glyphicon glyphicon-shopping-cart"></span></a></li>
            <li class="dropdown">
              <a href="/statistic" class="dropdown-toggle" data-toggle="dropdown">STATISTIC<span class="caret"></span><span style="font-size:16px;" class="pull-right hidden-xs glyphicon glyphicon-stats"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="/statistic">TODAY</a></li>
                <li><a href="/statistic/week">WEEKLY</a></li>
                <li><a href="/statistic/month">MONTHLY</a></li>
              </ul>
            </li>
          </ul>
        </div>
    </div>
  </nav>

  <div class="main container-fluid text-center">
    <h2>TODAY'S ORDER</h2>
    <p>This graph shows today's order.</p>
    </br>
    <canvas id="myChart" width="800" height="450"></canvas>

  </div>
  <script>
  var orderdata = <%- JSON.stringify(orderdata) %>;
  let _labels_index = {
    'Kotiruoka 1.': 0,
    'Kotiruoka 2.': 1,
    'Kasvisruoka': 2,
    'Kasviskeitto': 3,
    'Leipälounas': 4,
    'Erikoislounas': 5,
    'Jälkiruoka': 6
  };
  let _data = [0, 0, 0, 0, 0, 0, 0];
  for (let i = 0; i < orderdata.length; i++) {
    var index_label = _labels_index[orderdata[i]['_id']];
    _data[index_label] = orderdata[i]['count'];
  }
  //draw_chart('bar',_data);

      var config = {
          type: 'doughnut',
          data: {
              datasets: [{
                  data:
                    _data,
                  backgroundColor: ["#4F5C2F", "#89A04F", "#B2C485", "#CADBAB", "#AAB683", "#909779", "#737764"],
                  label: 'Dataset 1'
              }],
              labels: ['Kotiruoka 1.', 'Kotiruoka 2.', 'Kasvisruoka', 'Kasviskeitto', 'Leipälounas', 'Leipälounas', 'Jälkiruoka']
          },
          options: {
              responsive: true,
              legend: {
                  position: 'top',
              },
              animation: {
                  animateScale: true,
                  animateRotate: true
              }
          }
      };
      window.onload = function() {
          var ctx = document.getElementById("myChart").getContext("2d");
          window.myDoughnut = new Chart(ctx, config);
      };

    /*var orderdata = <%- JSON.stringify(orderdata) %>;
    let _labels_index = {
      'Kotiruoka 1.': 0,
      'Kotiruoka 2.': 1,
      'Kasvisruoka': 2,
      'Kasviskeitto': 3,
      'Leipälounas': 4,
      'Erikoislounas': 5,
      'Jälkiruoka': 6
    };
    let _data = [0, 0, 0, 0, 0, 0, 0];
    for (let i = 0; i < orderdata.length; i++) {
      var index_label = _labels_index[orderdata[i]['_id']];
      _data[index_label] = orderdata[i]['count'];
    }
    var chartData = {
      labels:['Kotiruoka 1.', 'Kotiruoka 2.', 'Kasvisruoka', 'Kasviskeitto', 'Leipälounas', 'Leipälounas', 'Jälkiruoka'],
      datasets:[{
        label: "The number of the meal order",
        backgroundColor: ["#4F5C2F", "#89A04F", "#B2C485", "#CADBAB", "#AAB683", "#909779", "#737764"],
        data: _data
      }]
    };
    window.onload = function(){
      var ctx = document.getElementById("myChart").getContext("2d");
      window.myChart = new Chart(ctx, {
        type:'bar',
        data: chartData,
        options: {
          responsive: true,
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true
              }
            }]
          }
        }
      });
    };*/
  </script>
</body>

</html>
