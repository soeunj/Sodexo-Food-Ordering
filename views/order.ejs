<!DOCTYPE html>
<html lang="en">

<head>
  <%- include header.ejs %>
</head>

<body>

  <nav class="navbar navbar-inverse sidebar" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#tab">
  				<span class="sr-only"></span>
  				<span class="icon-bar"></span>
  				<span class="icon-bar"></span>
  				<span class="icon-bar"></span>
  			</button>
        <a class="navbar-brand" href="/">Food Order System</a>
      </div>
      <div id="tab" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li><a href="/">HOME<span style="font-size:16px;" class="pull-right hidden-xs glyphicon glyphicon-home"></span></a></li>
          <li class="dropdown">
            <a href="/menu" class="dropdown-toggle" data-toggle="dropdown">MENU<span class="caret"></span><span style="font-size:16px;" class="pull-right hidden-xs glyphicon glyphicon-cutlery"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="/menu">TODAY</a></li>
              <li><a href="/menu/mon">MONDAY</a></li>
              <li><a href="/menu/tue">TUESDAY</a></li>
              <li><a href="/menu/wed">WEDNESDAY</a></li>
              <li><a href="/menu/thu">THURSDAY</a></li>
              <li><a href="/menu/fri">FRIDAY</a></li>
            </ul>
          </li>
          <li class="active"><a href="/order">ORDER<span style="font-size:16px;" class="pull-right hidden-xs glyphicon glyphicon-shopping-cart"></span></a></li>
          <li class="dropdown">
            <a href="/statistic" class="dropdown-toggle" data-toggle="dropdown">STATISTIC<span class="caret"></span><span style="font-size:16px;" class="pull-right hidden-xs glyphicon glyphicon-stats"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="/statistic">Today</a></li>
              <li><a href="/statistic">Monthly</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="main container-fluid text-center">
    <h2>ORDER LIST</h2>
    <p>This is your order list.</br>If you want to confirm your order, click order button.</p>
    </br>
    <table class="table">
      <thead>
        <tr>
          <th class="col-xs-3 text-center">Date</th>
          <th class="col-xs-6 text-center">Menu</th>
          <th class="col-xs-3 text-center">Count</th>
          <th class="col-xs-3 text-center">Delete</th>
        </tr>
      </thead>
      <tbody id="orderlist">
        <% for(var i=0; i<orderlist.length; i++) {%>
          <tr id="<%=orderlist[i]['_id']%>">
            <td class="col-xs-3 text-center">
              <%=orderlist[i]['date']%>
            </td>
            <td class="col-xs-6 text-center">
              <%=orderlist[i]['menu']%>
            </td>
            <td class="col-xs-3 text-center"><button id="minus<%=i%>" class="btn" onclick="minus(this.id)">-</button>
              <%=orderlist[i]['count']%><button id="puls<%=i%>" class="btn" onclick="plus(this.id)">+</button></td>
            <td class="col-xs-3 text-center"><button id="delete<%=i%>" class="btn" onclick="delete_order(this.id)">X</button></td>
          </tr>
          <% } %>
      </tbody>
    </table>
    <button id="order" class="btn btn-success pull-right" onclick="submitOrder();submitAll()">Order</button>
  </div>
  <script type="text/javascript">
    var data = <%-JSON.stringify(orderlist)%>;
    console.log(data.length);
    if (data.length == 0) {
      $('#order').prop('disabled', true);
    }
    if (data.length > 7) {
      console.log("quit");
    }

    function submitOrder() {
      if (confirm("Would you like to confirm your order?")) {
        alert("Success to order");
      }
    }

    function submitAll() {
      $.get("/submitorder", function(data, status) {
        location.reload();
      });
    }

    function minus(id) {
      var index = id[5];
      var minus_order = {
        id: data[index]['_id']
      };
      $.ajax({
        type: 'POST',
        url: '/minus',
        data: JSON.stringify(minus_order),
        dataType: 'json',
        contentType: 'application/json',
        success: function() {
          console.log('success to send');
          location.reload();
        }
      });
    }

    function plus(id) {
      var index = id[4];
      var plus_order = {
        id: data[index]['_id']
      };
      $.ajax({
        type: 'POST',
        url: '/plus',
        data: JSON.stringify(plus_order),
        dataType: 'json',
        contentType: 'application/json',
        success: function() {
          console.log('success to send');
          location.reload();
        }
      });
    }

    function delete_order(id) {
      var index = id[6];
      var delete_order = {
        id: data[index]['_id']
      };
      console.log(delete_order);
      $.ajax({
        type: 'POST',
        url: '/delete',
        data: JSON.stringify(delete_order),
        dataType: 'json',
        contentType: 'application/json',
        success: function() {
          console.log('success to send');
          location.reload();
        }
      });
    }
  </script>
</body>

</html>
