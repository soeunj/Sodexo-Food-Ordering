<!DOCTYPE html>
<html lang="en">
<head>
  <%- include header.ejs %>
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid" color="white">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Food Order System</a>
    </div>
    <div class="collapse navbar-collapse navbar-right" id="myNavbar">
      <ul class="nav navbar-nav">
        <li><a href="/">HOME</a></li>
        <li><a href="/menu">MENU</a></li>
        <li class="active"><a href="/order">ORDER</a></li>
        <li><a href="/statistic">STATISTIC</a></li>
      </ul>
    </div>
  </div>
</nav>

<div id="contents" class="container-fluid text-center">
  <div class="row content">
    <div class="col-sm-2 sidenav">
    <h4>ORDER</h4>
    </div>
    <div class="col-sm-9 text-center">
      <h2>ORDER LIST</h2>
      <p>This is your order list.</br>If you want to confirm your order, click order button.</p></br>
      <table class="table">
        <thead>
          <tr>
            <th class="col-xs-3 text-center">Date</th>
            <th class="col-xs-6 text-center">Menu</th>
            <th class="col-xs-3 text-center">Count</th>
            <th class="col-xs-3 text-center">Delete</th>
          </tr>
        </thead>
        <tbody id = "orderlist">
          <% for(var i=0; i<orderlist.length; i++) {%>
          <tr id = "<%=orderlist[i]['_id']%>" >
            <td class="col-xs-3 text-center"><%=orderlist[i]['date']%></td>
            <td class="col-xs-6 text-center"><%=orderlist[i]['menu']%></td>
            <td class="col-xs-3 text-center"><button id="minus<%=i%>" class="btn" onclick = "minus(this.id)">-</button><%=orderlist[i]['count']%><button id="puls<%=i%>" class="btn" onclick="plus(this.id)">+</button></td>
            <td class="col-xs-3 text-center"><button id="delete<%=i%>" class="btn" onclick="delete_order(this.id)">X</button></td>
          </tr>
      <% } %>
        </tbody>
      </table>
      <button id = "order" class="btn btn-success pull-right" onclick="submitOrder();submitAll()">Order</button>
    </div>
  </div>
</div>
<script type="text/javascript">
var data = <%-JSON.stringify(orderlist)%>;
console.log(data.length);
if(data.length == 0){
  $('#order').prop('disabled', true);
}
if(data.length > 7){
  console.log("quit");
}

function submitOrder(){
  if(confirm("Would you like to confirm your order?")){
    alert("Success to order");
  }
}

function submitAll(){
  $.get("/submitorder", function(data, status){
        location.reload();
    });
}

function minus(id){
  var index = id[5];
  var minus_order = {id:data[index]['_id']};
  $.ajax({
    type: 'POST',
    url:'/minus',
    data: JSON.stringify(minus_order),
    dataType: 'json',
    contentType: 'application/json',
    success: function() {
      console.log('success to send');
      location.reload();
    }
  });
}

function plus(id){
  var index = id[4];
  var plus_order = {id:data[index]['_id']};
  $.ajax({
    type: 'POST',
    url:'/plus',
    data: JSON.stringify(plus_order),
    dataType: 'json',
    contentType: 'application/json',
    success: function() {
      console.log('success to send');
      location.reload();
    }
  });
}

function delete_order(id){
  var index = id[6];
  var delete_order = {id:data[index]['_id']};
  console.log(delete_order);
  $.ajax({
    type: 'POST',
    url:'/delete',
    data: JSON.stringify(delete_order),
    dataType: 'json',
    contentType: 'application/json',
    success: function() {
      console.log('success to send');
      location.reload();
    }
  });
}
</script>
<footer class="container-fluid text-center">
<img src="img/sodexo.png" width="80"><img src="img/metropolia.png" width="100">
</footer>

</body>
</html>
